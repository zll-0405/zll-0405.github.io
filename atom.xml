<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>郑璐璐|个人博客</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2019-04-30T03:04:20.265Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>郑璐璐</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>[Keepalived]CentOS7.0 下安装教程</title>
    <link href="http://yoursite.com/posts/b7e72968.html"/>
    <id>http://yoursite.com/posts/b7e72968.html</id>
    <published>2019-04-30T03:02:13.000Z</published>
    <updated>2019-04-30T03:04:20.265Z</updated>
    
    <content type="html"><![CDATA[<table><tr><td bgcolor="navy" blue><font face="楷体" color="white" size="5"> 安装前所需环境</font></td></tr></table><p><font face="华文中宋" size="3">keepalived安装之前，需要环境：wget、gcc、pcre、openssl、zlib、popt-devel</font></p><p><font face="华文中宋" size="3">1，wget：用于从外网上下载插件<br><a id="more"></a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget安装命令：yum -y install wget</span><br></pre></td></tr></table></figure></font></p><p><font face="华文中宋" size="3">2，gcc：GCC（GNU Compiler Collection，GNU编译器套件），是由 GNU 开发的编程语言编译器。GCC原本作为GNU操作系统的官方编译器，现已被大多数类Unix操作系统（如Linux、BSD、Mac OS X等）采纳为标准的编译器<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc安装命令：yum install gcc-c++</span><br></pre></td></tr></table></figure></font></p><p><font face="华文中宋" size="3">3，pcre：PCRE(Perl Compatible Regular Expressions)安装 ，它是一个Perl库，包括 perl 兼容的正则表达式库。nginx的http模块使用pcre来解析正则表达式，所以需要在linux上安装pcre库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pcre安装命令：yum install -y pcre pcre-devel</span><br></pre></td></tr></table></figure></font></p><p><font face="华文中宋" size="3">4，openssl：它是一个强大的安全套接字层密码库，囊括主要的密码算法、常用的密钥和证书封装管理功能及SSL协议，并提供丰富的应用程序供测试或其它目的使用; nginx不仅支持http协议，还支持https（即在ssl协议上传输http），所以需要在linux安装openssl库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl安装命令：yum install -y openssl openssl-devel</span><br></pre></td></tr></table></figure></font></p><p><font face="华文中宋" size="3">5，zlib：它提供了很多种压缩和解压缩的方式，nginx使用zlib对http包的内容进行gzip，所以需要在linux上安装zlib库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zlib安装命令：yum install -y zlib zlib-devel</span><br></pre></td></tr></table></figure></font></p><p><font face="华文中宋" size="3">6，popt-devel 用于从外网上下载插件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">popt-devel安装命令: yum install –y popt-devel</span><br></pre></td></tr></table></figure></font></p><table><tr><td bgcolor="navy" blue><font face="楷体" color="white" size="5"> keepalived的安装及配置</font></td></tr></table><p><font face="华文中宋" size="3">（1） 进入一个目录（随便一个目录即可，用来存放下载的Keepalived的包，在此以/root目录为例）命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /root</span><br></pre></td></tr></table></figure></font></p><p><font face="华文中宋" size="3">（2） 下载keepalived安装包 ,本文用例keepalived1.3.4（目前最新版本可通过官网<a href="http://www.keepalived.org/softwar）" target="_blank" rel="noopener">http://www.keepalived.org/softwar）</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">命令: wget http://www.keepalived.org/software/keepalived-1.3.4.tar.gz</span><br></pre></td></tr></table></figure></font></p><p><font face="华文中宋" size="3">（3）解压keepalived-1.3.4.tar.gz<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">命令: tar -zxvf keepalived-1.3.4.tar.gz</span><br></pre></td></tr></table></figure></font></p><p><font face="华文中宋" size="3">（4）进入刚解压的目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">命令:cd keepalived-1.3.4</span><br></pre></td></tr></table></figure></font></p><p><font face="华文中宋" size="3">（5）进行相关配置（后半部分指定安装目录）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">命令:  ./configure -prefix=/usr/local/keepalived-1.3.4</span><br></pre></td></tr></table></figure></font></p><p><font face="华文中宋" size="3">（6）编译和安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">命令:make &amp;&amp; make install</span><br></pre></td></tr></table></figure></font></p><p><font face="华文中宋" size="3">（7）建立服务启动脚本，以便使用service命令控制，将路径为root/keepalived-1.3.4/keepalived/etc/init.d的文件keepalived拷贝到/etc/init.d下，具体命令:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /root/keepalived-1.3.4/keepalived/etc/init.d/keepalived /etc/init.d/keepalived</span><br></pre></td></tr></table></figure></font></p><p><font face="华文中宋" size="3">（8）由于安装使用非默认路径（本教程中使用的/usr/local/keepalived-1.3.4）故需修改相关路径，保证keepalived能正常启动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">文件 /etc/init.d/keepalived 大约15行位置将</span><br><span class="line">. /etc/sysconfig/keepalived 修改为</span><br><span class="line">. /usr/local/keepalived-1.3.4/etc/sysconfig/keepalived</span><br></pre></td></tr></table></figure></font></p><p><img src="https://img-blog.csdn.net/20180701145746631?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3psbF8wNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p><p><font face="华文中宋" size="3">（9）配置环境变量（将keepavlied主程序所在路径导入到环境变量PATH中）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">命令: vi /etc/profile</span><br><span class="line">加入相关内容</span><br><span class="line">export PATH=/usr/local/keepalived-1.3.4/sbin:$PATH</span><br><span class="line">(其中# add keepalived path为注释)</span><br></pre></td></tr></table></figure></font></p><p><img src="https://img-blog.csdn.net/20180701145717435?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3psbF8wNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p><p><font face="华文中宋" size="3">（10）用命令:source /etc/profile 使修改的环境变量生效<br>用命令: export 进行检查:<br><img src="https://img-blog.csdn.net/20180701145845543?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3psbF8wNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></font></p><p><font face="华文中宋" size="3">（11）建立可执行文件链接 命令:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/local/keepalived-1.3.4/sbin/keepalived /usr/sbin/</span><br></pre></td></tr></table></figure></font></p><p><font face="华文中宋" size="3">（12）修改keepalived配置文件命令:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /usr/local/keepalived-1.3.4/etc/keepalived/keepalived.conf</span><br></pre></td></tr></table></figure></font></p><p><font face="华文中宋" size="3">将配置文件中网卡修改为自己的网卡</font></p><p><font face="华文中宋" size="3">（13）编写配置文件中涉及到的监控Nginx脚本;（本教程以目录是在/usr/local/keepalived-1.3.4 下创建nginx_check.sh为例） </font></p><p><font face="华文中宋" size="3">①创建文件命令:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /usr/local/keepalived-1.3.4/nginx_check.sh</span><br></pre></td></tr></table></figure></font></p><p><font face="华文中宋" size="3">②编写内容并保存：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">nxPidNum=`ps -C nginx --no-header |wc -l`</span><br><span class="line">keepalivedPidNum=`ps -C keepalived --no-header |wc -l`             </span><br><span class="line">if [ $nxPidNum -eq 0 ];then                             </span><br><span class="line">    /usr/local/nginx-1.10.3/sbin/nginx  </span><br><span class="line">    sleep 3  </span><br><span class="line">    if [ `ps -C nginx --no-header |wc -l` -eq 0 ];then  </span><br><span class="line">       killall keepalived                     </span><br><span class="line">    elif [$keepalivedPidNum -eq 0 ];then</span><br><span class="line">       service keepalived start</span><br><span class="line">    fi  </span><br><span class="line">elif [ $keepalivedPidNum -eq 0 ];then</span><br><span class="line">    service keepalived start</span><br><span class="line">fi</span><br></pre></td></tr></table></figure></font></p><p><font face="华文中宋" size="3">③进入到相应目录下将监控Nginx编写的脚本提升权限为可执行文件，本例以/usr/local/keepalived-1.3.4 目录下的nginx_check.sh为例;命令:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x nginx_check.sh</span><br></pre></td></tr></table></figure></font></p><p><font face="华文中宋" size="3">检查文件是否变颜色，变颜色则说明为可执行文件<br><img src="https://img-blog.csdn.net/20180701150724866?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3psbF8wNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></font></p><p><font face="华文中宋" size="3">（14）修改相应文件，设置正确启动参数命令:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi /usr/local/keepalived-1.3.4/etc/sysconfig/keepalived </span><br><span class="line"> 修改的路径为安装路径下的配置文件修改内容:</span><br><span class="line">   KEEPALIVED_OPTIONS=&quot;-D -f /usr/local/keepalived-1.3.4/etc/keepalived/keepalived.conf&quot;</span><br></pre></td></tr></table></figure></font></p><p><font face="华文中宋" size="3">（15）将修改好的keepalived拷贝到/etc/etc/sysconfig 目录下 命令:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/local/keepalived-1.3.4/etc/sysconfig/keepalived /etc/sysconfig/</span><br></pre></td></tr></table></figure></font></p><p><font face="华文中宋" size="3">（16）测试:<br>①启动 命令:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service keepalived start</span><br></pre></td></tr></table></figure></font></p><p><font face="华文中宋" size="3">②查看keepalived运行状态，命令:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service keepalived status</span><br></pre></td></tr></table></figure></font></p><p><font face="华文中宋" size="3">提示：在配置keepalived.conf时，需要特别注意配置文件的语法格式，因为keepalived在启动时并不检测配置文件的正确性，即使没有配置文件，Keepalived也照样能够启动，所以一定要保证配置文件正确。只要下面出现提示信息为running证明成功<br><img src="https://img-blog.csdn.net/20180701151102134?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3psbF8wNDA1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></font></p>]]></content>
    
    <summary type="html">
    
      &lt;table&gt;&lt;tr&gt;&lt;td bgcolor=&quot;navy&quot; blue&gt;&lt;font face=&quot;楷体&quot; color=&quot;white&quot; size=&quot;5&quot;&gt; 安装前所需环境&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;

&lt;p&gt;&lt;font face=&quot;华文中宋&quot; size=&quot;3&quot;&gt;keepalived安装之前，需要环境：wget、gcc、pcre、openssl、zlib、popt-devel&lt;/font&gt;&lt;/p&gt;
&lt;p&gt;&lt;font face=&quot;华文中宋&quot; size=&quot;3&quot;&gt;1，wget：用于从外网上下载插件&lt;br&gt;
    
    </summary>
    
      <category term="运维" scheme="http://yoursite.com/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>[Linux]时间同步设置 + 防火墙设置 + SELinux 设置</title>
    <link href="http://yoursite.com/posts/d1d9f7bd.html"/>
    <id>http://yoursite.com/posts/d1d9f7bd.html</id>
    <published>2019-04-29T13:35:53.000Z</published>
    <updated>2019-04-30T01:29:07.284Z</updated>
    
    <content type="html"><![CDATA[<table><tr><td bgcolor="navy" blue><font face="楷体" color="white" size="5"> 时间同步设置</font></td></tr></table><p><font face="华文中宋" size="3">在大数据集群环境中，要求每台集群的时间必须是同步的，这样我们就会要求每台集群的时间必须和一台服务的时间是同步的。接下来介绍一下步骤：<br><a id="more"></a><br>1，设置ntp客户端<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y install ntp 安装ntp时间同步软件</span><br><span class="line">systemctl enable ntpd 使软件可用</span><br><span class="line">systemctl start ntpd 启动ntp软件</span><br></pre></td></tr></table></figure></font></p><p><font face="华文中宋" size="3">2，编辑/etc/ntp.conf文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/ntp.conf</span><br></pre></td></tr></table></figure></font></p><p><font face="华文中宋" size="3">重点修改以下内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Use public servers from the pool.ntp.org project.</span><br><span class="line"># Please consider joining the pool (http://www.pool.ntp.org/join.html).</span><br><span class="line">#server 0.centos.pool.ntp.org iburst</span><br><span class="line"> </span><br><span class="line">server 192.168.243.133   -------&gt;（此处需要修改，以哪台为准就写那台的IP）</span><br><span class="line"> </span><br><span class="line">restrict 192.168.243.133 nomodify notrap noquery-------&gt;（此处需要修改，以哪台为准就写那台的IP）</span><br><span class="line"> </span><br><span class="line">server 192.168.243.***     -------&gt;（本机IP是多少就写多少）</span><br><span class="line">fudge 192.168.243.*** -------&gt;（本机IP是多少就写多少） stratum 10</span><br></pre></td></tr></table></figure></font></p><p><font face="华文中宋" size="3">3，重启ntpd服务：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart ntpd</span><br></pre></td></tr></table></figure></font></p><p><font face="华文中宋" size="3">4，启动后，查看同步情况：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ntpq -p</span><br><span class="line">ntpstat</span><br></pre></td></tr></table></figure></font></p><table><tr><td bgcolor="navy" blue><font face="楷体" color="white" size="5"> 防火墙设置</font></td></tr></table><p><font face="华文中宋" size="3">关闭firewall：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">临时关闭防火墙: systemctl stop firewalld </span><br><span class="line">永久关闭防火墙： systemctl disable firewalld.service</span><br></pre></td></tr></table></figure></font></p><p><font face="华文中宋" size="3">关闭iptables：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">关闭命令： service iptables stop </span><br><span class="line">永久关闭防火墙：chkconfig iptables off </span><br><span class="line">检查防火墙状态：service iptables status</span><br></pre></td></tr></table></figure></font></p><p><font face="华文中宋" size="3">查看防火墙状态：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">检查firewall的状态：systemctl status firewalld.service</span><br><span class="line">检查iptables状态：service iptables status</span><br></pre></td></tr></table></figure></font></p><table><tr><td bgcolor="navy" blue><font face="楷体" color="white" size="5"> SELinux设置</font></td></tr></table><p><font face="华文中宋" size="3">1，临时关闭SELinux：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setenforce 0</span><br></pre></td></tr></table></figure></font></p><p><font face="华文中宋" size="3">2，永久关闭SELinux：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/selinux/config</span><br><span class="line">将配置文件中SELINUX=enforcing改为SELINUX=disabled</span><br><span class="line">注：修改配置文件需要重启机器，但我们已临时关闭SELinux，等下次机器重启后，配置文件自动生效</span><br></pre></td></tr></table></figure></font></p>]]></content>
    
    <summary type="html">
    
      &lt;table&gt;&lt;tr&gt;&lt;td bgcolor=&quot;navy&quot; blue&gt;&lt;font face=&quot;楷体&quot; color=&quot;white&quot; size=&quot;5&quot;&gt; 时间同步设置&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;

&lt;p&gt;&lt;font face=&quot;华文中宋&quot; size=&quot;3&quot;&gt;在大数据集群环境中，要求每台集群的时间必须是同步的，这样我们就会要求每台集群的时间必须和一台服务的时间是同步的。接下来介绍一下步骤：&lt;br&gt;
    
    </summary>
    
      <category term="运维" scheme="http://yoursite.com/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
  </entry>
  
</feed>
